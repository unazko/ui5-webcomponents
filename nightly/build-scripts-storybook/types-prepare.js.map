{"version":3,"file":"types-prepare.js","sourceRoot":"","sources":["../../build-scripts-storybook/types-prepare.ts"],"names":[],"mappings":"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","sourcesContent":["import fs from \"fs/promises\";\nimport path from \"path\";\nimport type {\n\tClassDeclaration,\n\tPackage,\n\tEnumDeclaration,\n\tInterfaceDeclaration,\n\tReference,\n} from \"@ui5/webcomponents-tools/lib/cem/types-internal\";\n\nconst FIORI_INTERFACES_FILE_NAME = '../_stories/fiori/Interfaces.mdx';\nconst MAIN_INTERFACES_FILE_NAME = '../_stories/main/Interfaces.mdx';\nconst FIORI_ENUM_FILE_NAME = '../_stories/fiori/Enums.mdx';\nconst MAIN_ENUM_FILE_NAME = '../_stories/main/Enums.mdx';\n\ntype StorybookInterfaceDeclaration = InterfaceDeclaration & { _ui5package: string };\ntype StorybookEnumDeclaration = EnumDeclaration & { _ui5package: string };\ntype StorybookClassDeclaration = ClassDeclaration & { _ui5package: string };\n\ntype EnhancedInterfaceDeclartion = StorybookInterfaceDeclaration & { implementations: string[] };\nconst interfaceDeclarations: Map<string, EnhancedInterfaceDeclartion> = new Map();\nconst enumDeclarations: Array<StorybookEnumDeclaration> = [];\n\nconst generateFileContent = (content: string, kind: string) => {\n\treturn `import { Meta } from \"@storybook/blocks\";\n\nimport { Footer } from \"@sb/components/footer/Footer.tsx\";\nimport {\n\tTitle\n} from \"@storybook/addon-docs\";\n\n<Meta name=\"${kind}\" />\n\n<header>\n\t<span className=\"sb-ui5-title\">\n\t<Title>${kind}</Title>\n\t</span>\n</header>\n\n${content}\n\n<Footer />`\n}\n\nconst registerDeclaration = (declaration: StorybookInterfaceDeclaration) => {\n\tconst declarationName = `${declaration._ui5package}/${declaration.name}`;\n\n\t(declaration as EnhancedInterfaceDeclartion).implementations = [];\n\n\tinterfaceDeclarations.set(declarationName, (declaration as EnhancedInterfaceDeclartion))\n};\n\nconst processDeclaration = (classDeclaration: StorybookClassDeclaration, reference: Reference) => {\n\tconst declarationName = `${reference.package}/${reference.name}`;\n\tconst declaration = interfaceDeclarations.get(declarationName);\n\n\tif (declaration) {\n\t\tdeclaration.implementations?.push(`${classDeclaration._ui5package}/${classDeclaration.name}`);\n\t}\n}\n\nconst prepareTypes = async () => {\n\tconst api: Package = JSON.parse((await fs.readFile(`./.storybook/custom-elements.json`)).toString());\n\n\tapi.modules.map(moduleDoc => {\n\t\tmoduleDoc.declarations?.forEach(declaration => {\n\t\t\tif (declaration.kind === \"interface\") {\n\t\t\t\tregisterDeclaration(declaration as StorybookInterfaceDeclaration);\n\t\t\t}\n\n\t\t\tif (declaration.kind === \"enum\") {\n\t\t\t\tenumDeclarations.push(declaration as StorybookEnumDeclaration)\n\t\t\t}\n\t\t});\n\n\t\treturn moduleDoc;\n\t})\n\t\t.map(moduleDoc => {\n\t\t\tmoduleDoc.declarations?.forEach(declaration => {\n\t\t\t\tif (declaration.kind === \"class\" && declaration._ui5implements) {\n\t\t\t\t\tdeclaration._ui5implements.forEach(interfaceDeclaration => processDeclaration(declaration as StorybookClassDeclaration, interfaceDeclaration))\n\t\t\t\t}\n\t\t\t});\n\n\t\t\treturn moduleDoc;\n\t\t})\n}\n\nconst generateInterfacesSection = (interfaces: Array<EnhancedInterfaceDeclartion>) => {\n\tlet content = \"\";\n\n\tif (interfaces.length) {\n\t\tcontent += `| Name | Description | Implementations |\n| --- | --- | --- |\n${interfaces.map((interfaceE) => {\n\t\t\treturn `| <b>${interfaceE.name}</b> | ${interfaceE.description}${renderSince(interfaceE._ui5since)}${renderDeprecated(interfaceE.deprecated)} | ${interfaceE.implementations?.join(\"<br /><br />\")}`;\n\t\t}).join(\"\\n\")}`\n\t}\n\n\treturn content\n}\n\nconst renderDeprecated = (deprecated?: string | boolean): string => {\n\tif (!deprecated) {\n\t\treturn \"\";\n\t}\n\n\n\treturn typeof deprecated === \"string\" ? `<br /><b>Deprecated:</b> ${deprecated}` : \"<br /><b>Deprecated:</b> This field is deprecated\";\n}\n\nconst renderSince = (since?: string): string => {\n\tif (!since) {\n\t\treturn \"\";\n\t}\n\n\treturn `<br /><b>Since:</b> ${since}`;\n}\n\nconst renderDescription = (description?: string): string => {\n\tif (!description) {\n\t\treturn \"\";\n\t}\n\n\treturn description ? `<br />${description.trim().replaceAll(/\\n/g, \"<br />\")}` : \"\";\n}\n\nconst generateEnumsSection = (enums: Array<EnumDeclaration>) => {\n\tlet content = \"\";\n\n\tif (enums.length) {\n\t\tcontent += `| Name | Description | Available fields |\n| --- | --- | --- |\n`\n\t\tcontent += enums.map((enumDeclaration) => {\n\t\t\treturn `| <b>${enumDeclaration.name}</b> | ${enumDeclaration.description}${renderSince(enumDeclaration._ui5since)}${renderDeprecated(enumDeclaration.deprecated)} | <ul>${enumDeclaration.members?.map(member => {return `<li>${enumDeclaration.name}.<b>${member.name}</b>${renderDescription(member.description)}${renderSince(member._ui5since)}${renderDeprecated(member.deprecated)}</li>`}).join(\" \")}</ul> |`}).join(\"\\n\")\n\t}\n\n\treturn content\n}\n\nconst generateContent = async () => {\n\tconst mainInterfaces = [...interfaceDeclarations.values()].filter(declaration => declaration._ui5package === \"@ui5/webcomponents\");\n\tconst fioriInterfaces = [...interfaceDeclarations.values()].filter(declaration => declaration._ui5package === \"@ui5/webcomponents-fiori\");\n\tconst mainEnums = enumDeclarations.filter(declaration => declaration._ui5package === \"@ui5/webcomponents\");\n\tconst fioriEnums = enumDeclarations.filter(declaration => declaration._ui5package === \"@ui5/webcomponents-fiori\");\n\n\tif (mainInterfaces.length) {\n\t\tawait fs.writeFile(path.join(__dirname, MAIN_INTERFACES_FILE_NAME), generateFileContent(generateInterfacesSection(mainInterfaces), \"Interfaces\"));\n\t}\n\n\tif (mainEnums.length) {\n\t\tawait fs.writeFile(path.join(__dirname, MAIN_ENUM_FILE_NAME), generateFileContent(generateEnumsSection(mainEnums), \"Enums\"));\n\t}\n\n\tif (fioriInterfaces.length) {\n\t\tawait fs.writeFile(path.join(__dirname, FIORI_INTERFACES_FILE_NAME), generateFileContent(generateInterfacesSection(fioriInterfaces), \"Interfaces\"));\n\t}\n\n\tif (fioriEnums.length) {\n\t\tawait fs.writeFile(path.join(__dirname, FIORI_ENUM_FILE_NAME), generateFileContent(generateEnumsSection(fioriEnums), \"Enums\"));\n\t}\n}\n\nprepareTypes().then(generateContent).then(() => console.log(\"Enums/interfaces documentation pages are generated\"));"]}