"use strict";import{registerFeature as a}from"../FeaturesRegistry.js";import{isF6Next as r,isF6Previous as l}from"../Keys.js";import{instanceOfUI5Element as u}from"../UI5Element.js";import{getFirstFocusableElement as h}from"../util/FocusableElements.js";import m from"../util/getFastNavigationGroups.js";import p from"../util/isElementClickable.js";class n{constructor(){this.selectedGroup=null;this.groups=[];this.keydownHandler=this._keydownHandler.bind(this),this.attachEventListeners()}attachEventListeners(){document.addEventListener("keydown",this.keydownHandler)}async groupElementToFocus(e){const s=u(e)?e.getDomRef():e;if(s){if(p(s))return s;const t=await h(s);if(t)return t}}async findNextFocusableGroupElement(e){let s;for(let t=0;t<this.groups.length;t++){let o;if(e>-1?e+1>=this.groups.length?(e=0,o=this.groups[e]):(e+=1,o=this.groups[e]):(e=0,o=this.groups[e]),s=await this.groupElementToFocus(o),s)break}return s}async findPreviousFocusableGroupElement(e){let s;for(let t=0;t<this.groups.length;t++){let o;if(e>0?(e=await this.groupElementToFocus(this.groups[e-1])===await this.groupElementToFocus(this.groups[e])?e-2:e-1,e<0&&(e=this.groups.length-1),o=this.groups[e]):(e=this.groups.length-1,o=this.groups[e]),s=await this.groupElementToFocus(o),s)break}return s}async _keydownHandler(e){const s=r(e),t=l(e);if(!(s||t)||(this.updateGroups(),this.groups.length<1))return;e.preventDefault();let o;if(this.groups.length===0)return o=await this.groupElementToFocus(this.groups[0]),o?.focus();let i=-1;this.selectedGroup&&(i=this.groups.indexOf(this.selectedGroup)),s&&(o=await this.findNextFocusableGroupElement(i)),t&&(o=await this.findPreviousFocusableGroupElement(i)),o?.focus()}removeEventListeners(){document.removeEventListener("keydown",this.keydownHandler)}updateGroups(){this.setSelectedGroup(),this.groups=m(document.body)}setSelectedGroup(e=window.document){const s=window.document.querySelector("html");let t=this.deepActive(e);for(;t&&t.getAttribute("data-sap-ui-fastnavgroup")!=="true"&&t!==s;)t=t.parentElement?t.parentNode:t.parentNode.host;this.selectedGroup=t}deepActive(e){return e.activeElement&&e.activeElement.shadowRoot?this.deepActive(e.activeElement.shadowRoot):e.activeElement}destroy(){this.removeEventListeners()}static init(){return this._instance||(this._instance=new n),this._instance}}a("F6Navigation",n);export default n;
//# sourceMappingURL=F6Navigation.js.map
